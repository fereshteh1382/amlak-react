{"ast":null,"code":"var _jsxFileName = \"F:\\\\amlak-react\\\\frontend\\\\src\\\\components\\\\context\\\\userContext.jsx\";\nimport React, { useState, useRef } from \"react\";\nimport SimpleReactValidator from \"simple-react-validator\";\nimport { useDispatch } from \"react-redux\";\nimport { context } from \"./context\";\nimport { successMessage, errorMessage } from \"./../../utils/message\";\nimport { loginUser, registerUser } from \"../../services/userService\";\nimport { decodeToken } from \"./../../utils/decodeToken\";\nimport { withRouter } from \"react-router\";\nimport { addUser } from \"./../../actions/user\";\nimport { showLoading, hideLoading } from \"react-redux-loading-bar\";\n\nconst UserContext = ({\n  children,\n  history\n}) => {\n  const [fullname, setFullname] = useState(\"\");\n  const [mobile, setMobile] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [policy, setPolicy] = useState();\n  const [, forceUpdate] = useState();\n  const dispatch = useDispatch();\n  const validator = useRef(new SimpleReactValidator({\n    messages: {\n      required: \"پر کردن این فیلد الزامی میباشد\",\n      min: \"کمتر از 5 کاراکتر نباید باشد\",\n      email: \"ایمیل نوشته شده صحیح نمی باشد\",\n      mobile: \"شماره موبایل صحیحی نیست \"\n    },\n    element: message => React.createElement(\"div\", {\n      style: {\n        color: \"red\"\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 31\n      },\n      __self: this\n    }, message)\n  }));\n\n  const resetStates = () => {\n    setFullname(\"\");\n    setEmail(\"\");\n    setPassword(\"\");\n    setPolicy();\n  };\n\n  const handleLogin = async event => {\n    event.preventDefault();\n    const user = {\n      email,\n      password\n    };\n\n    try {\n      if (validator.current.allValid()) {\n        dispatch(showLoading());\n        const {\n          status,\n          data\n        } = await loginUser(user); //  console.log(status);\n\n        if (status === 200) {\n          successMessage(\"ورود موفقیت آمیز بود.\");\n          localStorage.setItem(\"token\", data.token);\n          dispatch(addUser(decodeToken(data.token).payload.user));\n          dispatch(hideLoading());\n          history.replace('/');\n          resetStates();\n        }\n      } else {\n        validator.current.showMessages();\n        forceUpdate(1);\n      }\n    } catch (ex) {\n      console.log(ex);\n      dispatch(hideLoading());\n      errorMessage(\"ورود موفقیت آمیز نبود.\");\n    }\n  };\n\n  const handleRegister = async event => {\n    event.preventDefault();\n    const user = {\n      fullname,\n      email,\n      password\n    };\n\n    try {\n      if (validator.current.allValid()) {\n        dispatch(showLoading());\n        const {\n          status\n        } = await registerUser(user);\n        console.log(status);\n\n        if (status === 201) {\n          successMessage(\"کاربر با موفقیت ساخته شد.\");\n          dispatch(hideLoading());\n          history.push(\"/login\");\n        } else if (status === 202) {\n          errorMessage(\"شناسه ای با این ایمیل قبلا ثبت شده است.\");\n          dispatch(hideLoading());\n          history.push(\"/resister\");\n        }\n      } else {\n        validator.current.showMessages();\n        forceUpdate(1);\n      }\n    } catch (ex) {\n      errorMessage(\"مشکلی در ثبت نام پیش آمده.\");\n      dispatch(hideLoading());\n      console.log(ex);\n    }\n  };\n\n  return React.createElement(context.Provider, {\n    value: {\n      fullname,\n      setFullname,\n      email,\n      setEmail,\n      password,\n      setPassword,\n      policy,\n      setPolicy,\n      validator,\n      handleLogin,\n      handleRegister\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 105\n    },\n    __self: this\n  }, children);\n};\n\nexport default withRouter(UserContext);","map":{"version":3,"sources":["F:/amlak-react/frontend/src/components/context/userContext.jsx"],"names":["React","useState","useRef","SimpleReactValidator","useDispatch","context","successMessage","errorMessage","loginUser","registerUser","decodeToken","withRouter","addUser","showLoading","hideLoading","UserContext","children","history","fullname","setFullname","mobile","setMobile","password","setPassword","policy","setPolicy","forceUpdate","dispatch","validator","messages","required","min","email","element","message","color","resetStates","setEmail","handleLogin","event","preventDefault","user","current","allValid","status","data","localStorage","setItem","token","payload","replace","showMessages","ex","console","log","handleRegister","push"],"mappings":"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","sourcesContent":["import React, { useState, useRef } from \"react\";\r\nimport SimpleReactValidator from \"simple-react-validator\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { context } from \"./context\";\r\nimport { successMessage, errorMessage } from \"./../../utils/message\";\r\nimport { loginUser, registerUser } from \"../../services/userService\";\r\nimport { decodeToken } from \"./../../utils/decodeToken\";\r\nimport { withRouter } from \"react-router\";\r\nimport { addUser } from \"./../../actions/user\";\r\nimport { showLoading, hideLoading } from \"react-redux-loading-bar\";\r\n\r\n\r\nconst UserContext = ({ children, history }) => {\r\n    const [fullname, setFullname] = useState(\"\");\r\n    const [mobile, setMobile] = useState(\"\");\r\n    const [password, setPassword] = useState(\"\");\r\n    const [policy, setPolicy] = useState();\r\n\r\n    const [, forceUpdate] = useState();\r\n\r\n    const dispatch = useDispatch();\r\n\r\n    const validator = useRef(\r\n        new SimpleReactValidator({\r\n            messages: {\r\n                required: \"پر کردن این فیلد الزامی میباشد\",\r\n                min: \"کمتر از 5 کاراکتر نباید باشد\",\r\n                email: \"ایمیل نوشته شده صحیح نمی باشد\",\r\n                mobile: \"شماره موبایل صحیحی نیست \"\r\n            },\r\n            element: message => <div style={{ color: \"red\" }}>{message}</div>\r\n        })\r\n    );\r\n\r\n    const resetStates = () => {\r\n        setFullname(\"\");\r\n        setEmail(\"\");\r\n        setPassword(\"\");\r\n        setPolicy();\r\n    };\r\n\r\n    const handleLogin = async event => {\r\n        event.preventDefault();\r\n        const user = { email, password };\r\n\r\n        try {\r\n            if (validator.current.allValid()) {\r\n                dispatch(showLoading());\r\n                const { status, data } = await loginUser(user);\r\n                //  console.log(status);\r\n                if (status === 200) {\r\n                    successMessage(\"ورود موفقیت آمیز بود.\");\r\n                    localStorage.setItem(\"token\", data.token);\r\n                    dispatch(addUser(decodeToken(data.token).payload.user));\r\n                    dispatch(hideLoading());\r\n                    history.replace('/');\r\n                    resetStates();\r\n                }\r\n            } else {\r\n                validator.current.showMessages();\r\n\r\n                forceUpdate(1);\r\n            }\r\n        } catch (ex) {\r\n            console.log(ex);\r\n            dispatch(hideLoading());\r\n            errorMessage(\"ورود موفقیت آمیز نبود.\");\r\n        }\r\n    };\r\n\r\n    const handleRegister = async event => {\r\n        event.preventDefault();\r\n        const user = {\r\n            fullname,\r\n            email,\r\n            password\r\n        };\r\n\r\n        try {\r\n            if (validator.current.allValid()) {\r\n                dispatch(showLoading());\r\n                const { status } = await registerUser(user);\r\n                console.log(status);\r\n                if (status === 201) {\r\n                    successMessage(\"کاربر با موفقیت ساخته شد.\");\r\n                    dispatch(hideLoading());\r\n                    history.push(\"/login\");\r\n                } else if (status === 202) {\r\n                    errorMessage(\"شناسه ای با این ایمیل قبلا ثبت شده است.\");\r\n                    dispatch(hideLoading());\r\n                    history.push(\"/resister\");\r\n                }\r\n            } else {\r\n                validator.current.showMessages();\r\n                forceUpdate(1);\r\n            }\r\n        } catch (ex) {\r\n            errorMessage(\"مشکلی در ثبت نام پیش آمده.\");\r\n            dispatch(hideLoading());\r\n            console.log(ex);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <context.Provider\r\n            value={{\r\n                fullname,\r\n                setFullname,\r\n                email,\r\n                setEmail,\r\n                password,\r\n                setPassword,\r\n                policy,\r\n                setPolicy,\r\n                validator,\r\n                handleLogin,\r\n                handleRegister\r\n            }}\r\n        >\r\n            {children}\r\n        </context.Provider>\r\n    );\r\n};\r\n\r\nexport default withRouter(UserContext);\r\n"]},"metadata":{},"sourceType":"module"}