{"ast":null,"code":"var _jsxFileName = \"F:\\\\KitMelk\\\\frontend\\\\src\\\\components\\\\context\\\\userContext.jsx\";\nimport React, { useState, useRef } from \"react\";\nimport SimpleReactValidator from \"simple-react-validator\";\nimport { useDispatch } from \"react-redux\";\nimport { context } from \"./context\";\nimport { successMessage, errorMessage } from \"./../../utils/message\";\nimport { loginUser, registerUser, getadminUrl } from \"../../services/userService\";\nimport { decodeToken } from \"./../../utils/decodeToken\";\nimport { withRouter } from \"react-router\";\nimport { addUser } from \"./../../actions/user\";\nimport { showLoading, hideLoading } from \"react-redux-loading-bar\";\n\nconst UserContext = ({\n  children,\n  history\n}) => {\n  const [fullname, setFullname] = useState(\"\");\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [policy, setPolicy] = useState();\n  const [, forceUpdate] = useState();\n  const dispatch = useDispatch();\n  const validator = useRef(new SimpleReactValidator({\n    messages: {\n      required: \"پر کردن این فیلد الزامی میباشد\",\n      min: \"کمتر از 5 کاراکتر نباید باشد\",\n      email: \"ایمیل نوشته شده صحیح نمی باشد\"\n    },\n    element: message => React.createElement(\"div\", {\n      style: {\n        color: \"red\"\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 29\n      },\n      __self: this\n    }, message)\n  }));\n\n  const resetStates = () => {\n    setFullname(\"\");\n    setEmail(\"\");\n    setPassword(\"\");\n    setPolicy();\n  };\n\n  const handleLogin = async event => {\n    event.preventDefault();\n    const user = {\n      email,\n      password\n    };\n\n    try {\n      if (validator.current.allValid()) {\n        dispatch(showLoading());\n        const {\n          status,\n          data\n        } = await loginUser(user); //  console.log(status);\n\n        if (status === 200) {\n          successMessage(\"ورود موفقیت آمیز بود.\");\n          localStorage.setItem(\"token\", data.token);\n          dispatch(addUser(decodeToken(data.token).payload.user));\n          dispatch(hideLoading());\n          const {\n            adminurl\n          } = await getadminUrl();\n          history.replace(adminurl);\n          resetStates();\n        }\n      } else {\n        validator.current.showMessages();\n        forceUpdate(1);\n      }\n    } catch (ex) {\n      console.log(ex);\n      dispatch(hideLoading());\n      errorMessage(\"مشکلی پیش آمده.\");\n    }\n  };\n\n  const handleRegister = async event => {\n    event.preventDefault();\n    const user = {\n      fullname,\n      email,\n      password\n    };\n\n    try {\n      if (validator.current.allValid()) {\n        dispatch(showLoading());\n        const {\n          status\n        } = await registerUser(user);\n        console.log(status);\n\n        if (status === 201) {\n          successMessage(\"کاربر با موفقیت ساخته شد.\");\n          dispatch(hideLoading());\n          history.push(\"/login\");\n        } else if (status === 202) {\n          errorMessage(\"شناسه ای با این ایمیل قبلا ثبت شده است.\");\n          dispatch(hideLoading());\n          history.push(\"/resister\");\n        }\n      } else {\n        validator.current.showMessages();\n        forceUpdate(1);\n      }\n    } catch (ex) {\n      errorMessage(\"مشکلی در ثبت نام پیش آمده.\");\n      dispatch(hideLoading());\n      console.log(ex);\n    }\n  };\n\n  return React.createElement(context.Provider, {\n    value: {\n      fullname,\n      setFullname,\n      email,\n      setEmail,\n      password,\n      setPassword,\n      policy,\n      setPolicy,\n      validator,\n      handleLogin,\n      handleRegister\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 105\n    },\n    __self: this\n  }, children);\n};\n\nexport default withRouter(UserContext);","map":{"version":3,"sources":["F:/KitMelk/frontend/src/components/context/userContext.jsx"],"names":["React","useState","useRef","SimpleReactValidator","useDispatch","context","successMessage","errorMessage","loginUser","registerUser","getadminUrl","decodeToken","withRouter","addUser","showLoading","hideLoading","UserContext","children","history","fullname","setFullname","email","setEmail","password","setPassword","policy","setPolicy","forceUpdate","dispatch","validator","messages","required","min","element","message","color","resetStates","handleLogin","event","preventDefault","user","current","allValid","status","data","localStorage","setItem","token","payload","adminurl","replace","showMessages","ex","console","log","handleRegister","push"],"mappings":"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","sourcesContent":["import React, { useState, useRef } from \"react\";\r\nimport SimpleReactValidator from \"simple-react-validator\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { context } from \"./context\";\r\nimport { successMessage, errorMessage } from \"./../../utils/message\";\r\nimport { loginUser, registerUser, getadminUrl } from \"../../services/userService\";\r\nimport { decodeToken } from \"./../../utils/decodeToken\";\r\nimport { withRouter } from \"react-router\";\r\nimport { addUser } from \"./../../actions/user\";\r\nimport { showLoading, hideLoading } from \"react-redux-loading-bar\";\r\n\r\nconst UserContext = ({ children, history }) => {\r\n    const [fullname, setFullname] = useState(\"\");\r\n    const [email, setEmail] = useState(\"\");\r\n    const [password, setPassword] = useState(\"\");\r\n    const [policy, setPolicy] = useState();\r\n\r\n    const [, forceUpdate] = useState();\r\n\r\n    const dispatch = useDispatch();\r\n\r\n    const validator = useRef(\r\n        new SimpleReactValidator({\r\n            messages: {\r\n                required: \"پر کردن این فیلد الزامی میباشد\",\r\n                min: \"کمتر از 5 کاراکتر نباید باشد\",\r\n                email: \"ایمیل نوشته شده صحیح نمی باشد\"\r\n            },\r\n            element: message => <div style={{ color: \"red\" }}>{message}</div>\r\n        })\r\n    );\r\n\r\n    const resetStates = () => {\r\n        setFullname(\"\");\r\n        setEmail(\"\");\r\n        setPassword(\"\");\r\n        setPolicy();\r\n    };\r\n\r\n    const handleLogin = async event => {\r\n        event.preventDefault();\r\n        const user = { email, password };\r\n\r\n        try {\r\n            if (validator.current.allValid()) {\r\n                dispatch(showLoading());\r\n                const { status, data } = await loginUser(user);\r\n                //  console.log(status);\r\n                if (status === 200) {\r\n                    successMessage(\"ورود موفقیت آمیز بود.\");\r\n                    localStorage.setItem(\"token\", data.token);\r\n                    dispatch(addUser(decodeToken(data.token).payload.user));\r\n                    dispatch(hideLoading());\r\n                    const { adminurl } = await getadminUrl();\r\n                    history.replace(adminurl);\r\n\r\n                    resetStates();\r\n                }\r\n            } else {\r\n                validator.current.showMessages();\r\n\r\n                forceUpdate(1);\r\n            }\r\n        } catch (ex) {\r\n            console.log(ex);\r\n            dispatch(hideLoading());\r\n            errorMessage(\"مشکلی پیش آمده.\");\r\n        }\r\n    };\r\n\r\n    const handleRegister = async event => {\r\n        event.preventDefault();\r\n        const user = {\r\n            fullname,\r\n            email,\r\n            password\r\n        };\r\n\r\n        try {\r\n            if (validator.current.allValid()) {\r\n                dispatch(showLoading());\r\n                const { status } = await registerUser(user);\r\n                console.log(status);\r\n                if (status === 201) {\r\n                    successMessage(\"کاربر با موفقیت ساخته شد.\");\r\n                    dispatch(hideLoading());\r\n                    history.push(\"/login\");\r\n                } else if (status === 202) {\r\n                    errorMessage(\"شناسه ای با این ایمیل قبلا ثبت شده است.\");\r\n                    dispatch(hideLoading());\r\n                    history.push(\"/resister\");\r\n                }\r\n            } else {\r\n                validator.current.showMessages();\r\n                forceUpdate(1);\r\n            }\r\n        } catch (ex) {\r\n            errorMessage(\"مشکلی در ثبت نام پیش آمده.\");\r\n            dispatch(hideLoading());\r\n            console.log(ex);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <context.Provider\r\n            value={{\r\n                fullname,\r\n                setFullname,\r\n                email,\r\n                setEmail,\r\n                password,\r\n                setPassword,\r\n                policy,\r\n                setPolicy,\r\n                validator,\r\n                handleLogin,\r\n                handleRegister\r\n            }}\r\n        >\r\n            {children}\r\n        </context.Provider>\r\n    );\r\n};\r\n\r\nexport default withRouter(UserContext);\r\n"]},"metadata":{},"sourceType":"module"}